{{> header}}
{{> message}}

<!--collection stylesheet -->
<link rel="stylesheet" href="/resources/css/collection.css">

<main class="container mt-4">
  <h1>Your Owned Cards</h1>
  
  <!-- Grid container for cards -->
  <div class="collection-container">
    {{#each userCards}}
      <div class="collection-item">
        <h5>{{this.name}}</h5>

        
        <!--image-->


        <!-- <img src="/resources/images/cards/{{this.id}}.png" alt="{{this.name}}"> -->
        <!-- this should hopefully connect images to cards if you make it bohdi or maybe you want to completely overhaul it -->

        <p><strong>Sport:</strong> {{this.sport}}</p>
        <p><strong>Attack:</strong> {{this.attack}}</p>
        <p><strong>Defense:</strong> {{this.defense}}</p>
        <p><strong>Health:</strong> {{this.health}}</p>
        <p><strong>Overall:</strong> {{this.overall}}</p>
        <button class="btn btn-info btn-sm" onclick="viewPlayerStats({{this.id}})">View Stats</button>
      </div>
    {{/each}}
  </div>
</main>

<!--player details -->
<div class="modal fade" id="playerModal" tabindex="-1" aria-labelledby="playerModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="playerModalLabel">Player Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="playerModalBody">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Sorting functionality
  function sortTable(colIndex, type) {
  }

  function handleSortChange() {
    const dropdown = document.getElementById("sortDropdown");
    const value = dropdown.value;
    if (!value) return;
    const [colIndexStr, type] = value.split("_");
    const colIndex = parseInt(colIndexStr, 10);
    sortTable(colIndex, type);
  }

  function viewPlayerStats(playerId) {
    fetch(`/player/details/${playerId}`)
      .then(response => response.json())
      .then(data => {
        const modalBody = document.getElementById('playerModalBody');
        modalBody.innerHTML = `
          <h5>Card Stats</h5>
          <p><strong>Name:</strong> ${data.card_name}</p>
          <p><strong>Sport:</strong> ${data.sport}</p>
          <p><strong>Attack:</strong> ${data.attack}</p>
          <p><strong>Defense:</strong> ${data.defense}</p>
          <p><strong>Health:</strong> ${data.health}</p>
          <p><strong>Overall:</strong> ${data.overall}</p>
          <hr>
          <h5>NBA Stats</h5>
          ${ data.nba_id ? `
            <p><strong>Player Name:</strong> ${data.player_name}</p>
            <p><strong>League:</strong> ${data.league}</p>
            <p><strong>Team:</strong> ${data.team_abbreviation}</p>
            <p><strong>Age:</strong> ${data.age}</p>
            <p><strong>Height:</strong> ${data.player_height}</p>
            <p><strong>Weight:</strong> ${data.player_weight}</p>
            <p><strong>College:</strong> ${data.college}</p>
            <p><strong>Country:</strong> ${data.country}</p>
            <p><strong>Draft:</strong> Year ${data.draft_year}, Round ${data.draft_round}, Pick ${data.draft_number}</p>
            <p><strong>Games Played:</strong> ${data.gp}</p>

            <p><strong>PPG:</strong> ${data.pts}</p>
            <p><strong>Rebounds:</strong> ${data.reb}</p>
            <p><strong>Assists:</strong> ${data.ast}</p>
            <p><strong>Net Rating:</strong> ${data.net_rating}</p>
            <p><strong>Offensive Reb %:</strong> ${data.oreb_pct}</p>
            <p><strong>Defensive Reb %:</strong> ${data.dreb_pct}</p>
            <p><strong>Usage %:</strong> ${data.usg_pct}</p>
            <p><strong>True Shooting %:</strong> ${data.ts_pct}</p>
            <p><strong>Assist %:</strong> ${data.ast_pct}</p>
            <p><strong>Season:</strong> ${data.season}</p>
          ` : '<p>No NBA stats available.</p>' }
        `;
        var playerModal = new bootstrap.Modal(document.getElementById('playerModal'));
        playerModal.show();
      })
      // error handing incase the database isnt working
      .catch(err => {
        console.error(err);
        alert('Error fetching player details.');
      });
  }
</script>

{{> footer}}
